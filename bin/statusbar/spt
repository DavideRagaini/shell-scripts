#!/bin/sh

case $BLOCK_BUTTON in
	1) notify-send "Song" "$(playerctl -p spotify metadata --format "ﴁ {{artist}} 阮 {{title}}  {{album}}")" ;;
	3) playerctl play-pause ;;
	4) playerctl next ;;
	5) playerctl previuos ;;
esac

# set -x
sleep 15
sptstb="$XDG_CACHE_HOME/stbspt"

while [ -n "$(pidof spotify)" ]
do
	old="$(cat "$sptstb")"
	if [ "$(playerctl -p spotify status)" = "Playing" ]; then
		current="$(playerctl -p spotify metadata --format "阮{{title}}ﴁ{{artist}}{{album}}")"
		[ "$current" != "$old" ] &&
			printf "%.45s" "$current" > "$sptstb" &&
			pkill -RTMIN+12 dwmblocks
	else
		[ -n "$old" ] &&
			echo "" > "$sptstb" &&
			pkill -RTMIN+12 dwmblocks
	fi
	sleep 30
done

echo "" > "$sptstb"
pkill -RTMIN+12 dwmblocks
