#!/bin/sh

CACHE="$HOME/.cache/via"

build_cache() {
    # fd -c never -t f -E "Storage" -E "Projects" -E "Torrents" -E "Laboratorio Automazione" -E "Programmazione ad Oggetti" --base-directory "$HOME" >"$CACHE"
    # find "$HOME" -type f -iname "*.pdf" -not -path "./.*/*" -not -path "./Storage/*" >"$CACHE"
    locate -ri "$HOME/.*.pdf$" | sed "s@$HOME@"'~''@' >"$CACHE"
}

reader() {
    file="$(fzfmenu <"$CACHE")"
    [ -n "$file" ] &&
        zathura "$file"
}

case "$1" in
    -r)
        build_cache &&
            reader
        ;;
    -ro)
        build_cache
        ;;
    *)
        reader
        ;;
esac
