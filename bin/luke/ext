#!/usr/bin/env sh

# A general, all-purpose extraction script. Not all extraction programs here
# are installed by LARBS automatically.
#
# Default behavior: Extract archive into new directory
# Behavior with `-c` option: Extract contents into current directory

while getopts "hc" o; do case "${o}" in
	c) extracthere="True" ;;
	*) printf "Options:\\n   -c: Extract archive into current directory rather than a new one.\\n" && exit ;;
esac done

if [ -z "$extracthere" ]; then
	archive="$(readlink -f "$*")" &&
	directory="$(echo "$archive" | sed 's/\.[^\/.]*$//')" &&
	mkdir -p "$directory" &&
	cd "$directory" || exit
else
	archive="$(readlink -f "$(echo "$*" | cut -d' ' -f2)")"
fi

[ "$archive" = "" ] && printf "Give archive to extract as argument.\\n" && exit

if [ -f "$archive" ] ; then
	case "$archive" in
		#*.tar.bz2|*.tar.xz|*.tbz2) tar xvjf "$archive" ;;
		*.tar.bz2|*.tbz2) tar -v xvjf "$archive" ;;
		*.tar.xz) tar -v -xf "$archive" ;;
		*.tar.gz|*.tgz) tar -v xvzf "$archive" ;;
		*.lzma) unlzma -v "$archive" ;;
		*.bz2) bunzip2 -v "$archive" ;;
		*.rar) unrar -v x -ad "$archive" ;;
		*.gz) gunzip -v "$archive" ;;
		*.tar) tar -v xvf "$archive" ;;
		*.zip) unzip -v "$archive" ;;
		*.Z) uncompress -v "$archive" ;;
		*.7z) 7z -v x "$archive" ;;
		*.xz) unxz -v "$archive" ;;
		*.img.xz) unxz -v "$archive" ;;
		*.exe) cabextract -v "$archive" ;;
		*) printf "extract: '%s' - unknown archive method\\n" "$archive" ;;
	esac
else
	printf "File \"%s\" not found.\\n" "$archive"
fi
