#!/bin/sh

if pidof librespot; then
	CHOSEN="sptui"
elif pidof spotifyd; then
	CHOSEN="sptui"
elif [ "$(mpc status '%status%')" = 'playing' ]; then
	CHOSEN="Local"
else
	CHOSEN="$(printf 'Spotify\nLocal' | fzf --cycle --border --margin 10% --padding 10% --header='Choose music source')"
fi

case "$CHOSEN" in
	Local) exec ncmpcpp ;;
	Spotify)
		if command -v 'librespot'; then
		setsid -f librespot \
			--c ~/Storage/.cache/librespot \
			--backend pulseaudio \
			--cache-size-limit 1G \
			--name "$(hostname)" \
			--device-type computer \
			--initial-volume 71 \
			--bitrate 320
			# --enable-volume-normalisation \
			# --normalisation-pregain -2 \
		elif command -v 'spotifyd'; then
			setsid -f spotifyd
		fi ;;
	sptui)
		if command -v spotify-tui; then
			FRONTEND="spotify-tui"
		else
			FRONTEND='/home/davide/.local/share/cargo/bin/spt'
		fi
		exec $FRONTEND ;;
	*) notify-send "Something wrong"
esac
