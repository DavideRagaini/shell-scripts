#!/bin/sh
# TODO Pretty print
# TODO if no args then prompts time
# TODO Add check if attached to terminal, then echo

uts2date() {
    HTIME="$(date -d @"$1")"
}

HOURS=0
MINUTES=0
SECONDS=0
LABEL='Alarm'

while getopts "h:m:s:l:t:" arg; do
    case "$arg" in
        h) HOURS=$OPTARG ;;
        m) MINUTES=$OPTARG ;;
        s) SECONDS=$OPTARG ;;
        l) LABEL=$OPTARG ;;
        t) TIMESTAMP="$(( $(date -d "$OPTARG" +%s) - $(date +%s) ))"
           MINUTES=$(( (TIMESTAMP/60)%60 ))
           SECONDS=$(( TIMESTAMP%60 )) ;;
        *) echo "asdfdf"
            exit ;;
    esac
done

if [ -z $TIMESTAMP ]; then
    [ -z $HOURS ] && [ -z $MINUTES ] && [ -z $SECONDS ] && exit
    TIME=$((HOURS*3600 + MINUTES*60 + SECONDS ))
else
    TIME=$TIMESTAMP
fi

uts2date "$(( $(date '+%s') + TIME))"
echo "$LABEL:\nSleeps for $MINUTES:$SECONDS.\nRings @\n$HTIME"
[ -n "$DISPLAY" ] &&
    notify-send "$LABEL:\nSleeps for $MINUTES:$SECONDS" "\nRings @\n$HTIME"

sleep "$TIME"
ringing
