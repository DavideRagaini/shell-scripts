#!/bin/sh

# set -x
instances="$(playerctl -a -i spotify metadata --format "{{playerName}} -> {{status}}  {{title}} - {{artist}} {{album}}" | sed 's/Playing/奈/ ; s/Paused//')"

[ -z "$instances" ] && exit
[ "$(echo "$instances" | wc -l)" -eq 1 ] && playerctl -p "$(echo "$instances" | awk '{print $1}')" play-pause && exit

chosen="$(printf "%s" "$instances" | dmenu -l 5)" || exit
howmany=$(echo "$instances" | grep -c "$("$chosen" | awk '{print $1}')")
if [ "$howmany" -eq 1 ]
then
    playerctl -p "$($howmany | awk '{print $1}')" play-pause
else
    player="$(playerctl -l | dmenu -l 5)"
    playerctl -p "$player" play-pause
fi
