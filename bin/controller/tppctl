#!/bin/sh

instances="$(playerctl -a -i spotifyd metadata --format "{{playerName}} -> {{status}}  {{title}} - {{artist}} {{album}}" | sed 's/Playing/奈/ ; s/Paused//' | nl -w2 -s' ')"

# [ -z "$instances" ] && exit
[ "$(echo "$instances" | wc -l)" -eq 1 ] && playerctl -p "$(echo "$instances" | awk '{print $2}')" play-pause && exit

chosen="$(printf "%s" "$instances" | dmenu -l 5)" || exit
howmany=$(echo "$instances" | grep -c "$(echo "$chosen" | awk '{print $1}')")
if [ $howmany -eq 1 ]
then
    playerctl -p "$(echo "$chosen" | awk '{print $2}')" play-pause
else
    player="$(playerctl -l | dmenu -l 5)"
    playerctl -p "$player" play-pause
fi
