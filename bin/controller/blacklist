#!/bin/sh

HOSTS="${XDG_DATA_HOME:-$HOME/.local/share}/hosts"
SUPERHOSTS="${XDG_DATA_HOME:-$HOME/.local/share}/superhosts.deny"
UNBLOCK="reddit.com\
	redditmedia.com\ redditstatic.com\ web.whatsapp.com\
	4chan.org\
	boards.4chan.org"

set_hosts() {
    [ -e /etc/hosts ] ||
        (sudo ln -s "$HOSTS" "/etc/hosts" &&
            notify-send "Hosts Set")

    [ -e /etc/hosts.deny ] ||
        (sudo ln -s "$HOSTS.deny" "/etc/hosts.deny" &&
            notify-send "Hosts.deny Set")

    [ -e /etc/superhosts.deny ] ||
        (sudo ln -s "$SUPERHOSTS" "/etc/superhosts.deny" &&
            notify-send "Superhosts.deny Set")
}

delete_hosts() {
    for i in $@; do
        sed -i "/0.0.0.0	$i/d; /0.0.0.0	www.$i/d" "$HOSTS"
    done
}

case "$1" in
    on)
        set_hosts
        delete_hosts "$UNBLOCK"
        ;;

    off)
        delete_hosts "$BLOCKED"
        ;;

    update)
        # curl -o "$HOSTS" 'http://sbc.io/hosts/alternates/fakenews-gambling-porn/hosts'
        echo 'Downloading hosts'
        curl -o "$HOSTS" "https://hosts.ubuntu101.co.za/hosts"

        echo 'Downloading hosts.deny'
        curl -o "$HOSTS.deny" "https://hosts.ubuntu101.co.za/hosts"

        echo 'Downloading superhosts.deny'
        curl -o "$SUPERHOSTS" "https://hosts.ubuntu101.co.za/hosts"
        # delete_hosts "$UNBLOCK"
        ;;

    *)
        echo 'Need arg!'
        ;;
esac
