#!/bin/sh

NAMES=$(pactl list sinks | grep -E 'Name|State|Description|Active Port' | sed 's/Description: /->/g; s/\t//g;' | fmt -w 1000 | sed ':b;s/State:/\n/g;tb; s/Name: //g; s/Active Port:/On/g')

if [ $(echo $NAMES | wc -l) -lt 3 ]; then
	OUTPUT="$(printf "%s" "$NAMES" | grep "SUSPENDED")"
else
	CHOSEN=$(echo "$NAMES" | sed -n -e 's/^.*->//p' | dmenu -i -l 10 -p "Sink:") || exit
	OUTPUT=$(echo "$NAMES" | grep "$CHOSEN")
fi

OUTPUT=${OUTPUT## SUSPENDED}
OUTPUT=${OUTPUT%% -\>*}

pacmd set-default-sink "$OUTPUT"
pacmd list-sink-inputs | awk '/index:/{print $2}' | xargs -r -I{} pacmd move-sink-input {} "$OUTPUT"
pkill -RTMIN+7 dwmblocks
